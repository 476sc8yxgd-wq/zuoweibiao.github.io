<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åº§ä½å·æ›¿æ¢ä¸ºå§“åå·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        body {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 0 1rem;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 2rem;
        }
        .section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        h3 {
            color: #4299e1;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        .file-upload {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        input[type="file"] {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .file-name {
            color: #666;
            font-size: 0.9rem;
        }
        .config {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        .config-item {
            flex: 1;
            min-width: 200px;
        }
        label {
            display: block;
            margin-bottom: 0.3rem;
            color: #333;
            font-size: 0.9rem;
        }
        input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }
        button {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        #replaceBtn {
            background: #4299e1;
            color: white;
        }
        #replaceBtn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        #downloadBtn {
            background: #10b981;
            color: white;
            display: none;
        }
        #status {
            text-align: center;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }
        .success {
            background: #dcfce7;
            color: #166534;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
        }
        .loading {
            background: #e0f2fe;
            color: #083344;
        }
        .note {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #666;
        }
        .note ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
            line-height: 1.6;
        }
        .library-tip {
            text-align: center;
            color: #dc2626;
            margin: 1rem 0;
            font-weight: bold;
            display: none;
        }
    </style>
    <!-- æ›´æ¢ä¸ºå®˜æ–¹ç¨³å®šCDNï¼ˆä¼˜å…ˆåŠ è½½ï¼‰ -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>åº§ä½å·æ›¿æ¢ä¸ºå§“åå·¥å…·</h1>

        <!-- åº“åŠ è½½å¤±è´¥æç¤º -->
        <div class="library-tip" id="libraryTip">âŒ æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ä½¿ç”¨æœ¬åœ°å¼•å…¥æ–¹å¼ï¼</div>

        <!-- çŠ¶æ€æç¤ºåŒºåŸŸ -->
        <div id="status"></div>

        <!-- ç¬¬ä¸€æ­¥ï¼šä¸Šä¼ æ–‡ä»¶ -->
        <div class="section">
            <h3>1. ä¸Šä¼ æ–‡ä»¶</h3>
            <div class="file-upload">
                <input type="file" id="mappingFile" accept=".xlsx,.xls,.csv" title="é€‰æ‹©å§“å-åº§ä½å·æ˜ å°„è¡¨" disabled>
                <span class="file-name" id="mappingFileName">æœªé€‰æ‹©æ–‡ä»¶ï¼ˆéœ€åŒ…å«ã€Œåº§ä½å·ã€å’Œã€Œå§“åã€åˆ—ï¼‰</span>
            </div>
            <div class="file-upload">
                <input type="file" id="seatFile" accept=".xlsx,.xls,.csv" title="é€‰æ‹©çº¯åº§ä½å·è¡¨" disabled>
                <span class="file-name" id="seatFileName">æœªé€‰æ‹©æ–‡ä»¶ï¼ˆéœ€åŒ…å«åº§ä½å·ï¼Œæ ¼å¼ä¸æ˜ å°„è¡¨ä¸€è‡´ï¼‰</span>
            </div>
        </div>

        <!-- ç¬¬äºŒæ­¥ï¼šé…ç½®å‚æ•° -->
        <div class="section">
            <h3>2. é…ç½®å‚æ•°ï¼ˆé»˜è®¤æ— éœ€ä¿®æ”¹ï¼Œä¸Excelåˆ—åä¸€è‡´å³å¯ï¼‰</h3>
            <div class="config">
                <div class="config-item">
                    <label for="seatCol">æ˜ å°„è¡¨ä¸­ã€Œåº§ä½å·ã€åˆ—å</label>
                    <input type="text" id="seatCol" value="åº§ä½å·" placeholder="ä¾‹å¦‚ï¼šåº§ä½å·ã€åº§ä½ç¼–å·" disabled>
                </div>
                <div class="config-item">
                    <label for="nameCol">æ˜ å°„è¡¨ä¸­ã€Œå§“åã€åˆ—å</label>
                    <input type="text" id="nameCol" value="å§“å" placeholder="ä¾‹å¦‚ï¼šå§“åã€å­¦ç”Ÿå§“å" disabled>
                </div>
                <div class="config-item">
                    <label for="noMatchText">æ— åŒ¹é…å§“åæ—¶æ˜¾ç¤º</label>
                    <input type="text" id="noMatchText" value="æ— åŒ¹é…" placeholder="ä¾‹å¦‚ï¼šæ— åŒ¹é…ã€ç©ºåº§ä½" disabled>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="btn-group">
            <button id="replaceBtn" disabled>å¼€å§‹æ›¿æ¢</button>
            <button id="downloadBtn" disabled>ä¸‹è½½ç»“æœæ–‡ä»¶</button>
        </div>

        <!-- æ³¨æ„äº‹é¡¹ -->
        <div class="note">
            <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
            <ul>
                <li>æ”¯æŒæ–‡ä»¶æ ¼å¼ï¼š.xlsxï¼ˆæ¨èï¼‰ã€.xlsã€.csv</li>
                <li>æ˜ å°„è¡¨éœ€åŒ…å«ä¸¤åˆ—ï¼šåˆ—åéœ€ä¸é…ç½®é¡¹ä¸€è‡´ï¼ˆé»˜è®¤ã€Œåº§ä½å·ã€ã€Œå§“åã€ï¼‰</li>
                <li>åº§ä½è¡¨ä¸­çš„åº§ä½å·æ ¼å¼éœ€ä¸æ˜ å°„è¡¨å®Œå…¨ä¸€è‡´ï¼ˆå¦‚æ˜ å°„è¡¨æ˜¯ã€ŒA1-1ã€ï¼Œåº§ä½è¡¨ä¸èƒ½å¤šç©ºæ ¼ï¼‰</li>
                <li>è‡ªåŠ¨æŒ‰åº§ä½å·åç¼€æ•°å­—æ’åºï¼ˆå¦‚ A1-2 æ’åœ¨ A1-10 å‰ï¼‰</li>
                <li>æ–‡ä»¶å¤„ç†å…¨ç¨‹åœ¨æœ¬åœ°æµè§ˆå™¨å®Œæˆï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œå®‰å…¨éšç§</li>
            </ul>
            <strong style="margin-top: 1rem; display: block;">è‹¥å‡ºç°ã€Œåº“åŠ è½½å¤±è´¥ã€ï¼š</strong>
            <ul>
                <li>1. æ£€æŸ¥ç½‘ç»œæ˜¯å¦æ­£å¸¸ï¼Œåˆ·æ–°é¡µé¢é‡è¯•</li>
                <li>2. æ‰‹åŠ¨ä¸‹è½½ <a href="https://unpkg.com/xlsx/dist/xlsx.full.min.js" target="_blank">xlsx.full.min.js</a>ï¼Œä¸æœ¬HTMLæ–‡ä»¶æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹</li>
                <li>3. å°†å¤´éƒ¨CDNè„šæœ¬æ›¿æ¢ä¸ºï¼š&lt;script src="xlsx.full.min.js"&gt;&lt;/script&gt;</li>
            </ul>
        </div>
    </div>

    <script>
        // å…ˆæ£€æµ‹XLSXæ˜¯å¦åŠ è½½æˆåŠŸ
        window.onload = function() {
            const libraryTip = document.getElementById('libraryTip');
            const mappingFile = document.getElementById('mappingFile');
            const seatFile = document.getElementById('seatFile');
            const seatCol = document.getElementById('seatCol');
            const nameCol = document.getElementById('nameCol');
            const noMatchText = document.getElementById('noMatchText');

            if (typeof XLSX === 'undefined') {
                // åº“åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæç¤ºï¼Œç¦ç”¨åŠŸèƒ½
                libraryTip.style.display = 'block';
                showStatus('âŒ æ ¸å¿ƒåº“åŠ è½½å¤±è´¥ï¼Œæ— æ³•ä½¿ç”¨åŠŸèƒ½', 'error');
            } else {
                // åº“åŠ è½½æˆåŠŸï¼Œå¯ç”¨åŠŸèƒ½
                mappingFile.disabled = false;
                seatFile.disabled = false;
                seatCol.disabled = false;
                nameCol.disabled = false;
                noMatchText.disabled = false;
                showStatus('âœ… æ ¸å¿ƒåº“åŠ è½½æˆåŠŸï¼Œå¯ä¸Šä¼ æ–‡ä»¶', 'success');
            }
        };

        // å…¨å±€å˜é‡ï¼šå­˜å‚¨è§£æåçš„Excelæ•°æ®å’Œç”Ÿæˆçš„å·¥ä½œç°¿
        let mappingData = null; // æ˜ å°„è¡¨æ•°æ®ï¼ˆJSONæ•°ç»„ï¼‰
        let seatWorkbook = null; // åº§ä½è¡¨å·¥ä½œç°¿ï¼ˆç”¨äºç”Ÿæˆæ–°æ–‡ä»¶ï¼‰
        let resultWorkbook = null; // ç»“æœå·¥ä½œç°¿ï¼ˆæ›¿æ¢åï¼‰

        // DOMå…ƒç´ 
        const mappingFile = document.getElementById('mappingFile');
        const seatFile = document.getElementById('seatFile');
        const mappingFileName = document.getElementById('mappingFileName');
        const seatFileName = document.getElementById('seatFileName');
        const seatCol = document.getElementById('seatCol');
        const nameCol = document.getElementById('nameCol');
        const noMatchText = document.getElementById('noMatchText');
        const replaceBtn = document.getElementById('replaceBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const status = document.getElementById('status');

        // ç›‘å¬æ–‡ä»¶ä¸Šä¼ ï¼ˆæ˜ å°„è¡¨ï¼‰
        mappingFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) {
                mappingFileName.textContent = 'æœªé€‰æ‹©æ–‡ä»¶ï¼ˆéœ€åŒ…å«ã€Œåº§ä½å·ã€å’Œã€Œå§“åã€åˆ—ï¼‰';
                mappingData = null;
                checkBtnStatus();
                return;
            }
            mappingFileName.textContent = `å·²é€‰æ‹©ï¼š${file.name}`;
            // è§£æExcelæ–‡ä»¶
            parseExcelFile(file, (data) => {
                mappingData = data;
                showStatus(`âœ… æ˜ å°„è¡¨è§£ææˆåŠŸï¼Œå…± ${data.length} è¡Œæ•°æ®`, 'success');
                checkBtnStatus();
            }, (err) => {
                showStatus(`âŒ æ˜ å°„è¡¨è§£æå¤±è´¥ï¼š${err}`, 'error');
                mappingData = null;
                checkBtnStatus();
            });
        });

        // ç›‘å¬æ–‡ä»¶ä¸Šä¼ ï¼ˆåº§ä½è¡¨ï¼‰
        seatFile.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) {
                seatFileName.textContent = 'æœªé€‰æ‹©æ–‡ä»¶ï¼ˆéœ€åŒ…å«åº§ä½å·ï¼Œæ ¼å¼ä¸æ˜ å°„è¡¨ä¸€è‡´ï¼‰';
                seatWorkbook = null;
                checkBtnStatus();
                return;
            }
            seatFileName.textContent = `å·²é€‰æ‹©ï¼š${file.name}`;
            // è§£æExcelæ–‡ä»¶ï¼ˆä¿ç•™å·¥ä½œç°¿å¯¹è±¡ï¼Œç”¨äºç”Ÿæˆæ–°æ–‡ä»¶ï¼‰
            parseExcelFileWithWorkbook(file, (workbook, data) => {
                seatWorkbook = workbook;
                showStatus(`âœ… åº§ä½è¡¨è§£ææˆåŠŸï¼Œå…± ${data.length} è¡Œæ•°æ®`, 'success');
                checkBtnStatus();
            }, (err) => {
                showStatus(`âŒ åº§ä½è¡¨è§£æå¤±è´¥ï¼š${err}`, 'error');
                seatWorkbook = null;
                checkBtnStatus();
            });
        });

        // å¼€å§‹æ›¿æ¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        replaceBtn.addEventListener('click', () => {
            if (!mappingData || !seatWorkbook) {
                showStatus('âŒ è¯·å…ˆä¸Šä¼ å¹¶è§£æä¸¤ä¸ªæ–‡ä»¶', 'error');
                return;
            }

            const seatColName = seatCol.value.trim();
            const nameColName = nameCol.value.trim();
            const noMatch = noMatchText.value.trim() || 'æ— åŒ¹é…';

            // æ ¡éªŒåˆ—åæ˜¯å¦å­˜åœ¨
            if (!mappingData[0] || !mappingData[0].hasOwnProperty(seatColName)) {
                showStatus(`âŒ æ˜ å°„è¡¨ç¼ºå°‘åˆ—ï¼š${seatColName}`, 'error');
                return;
            }
            if (!mappingData[0].hasOwnProperty(nameColName)) {
                showStatus(`âŒ æ˜ å°„è¡¨ç¼ºå°‘åˆ—ï¼š${nameColName}`, 'error');
                return;
            }

            showStatus('ğŸ”„ æ­£åœ¨æ›¿æ¢åº§ä½å·ä¸ºå§“å...', 'loading');

            try {
                // 1. æ„å»ºåº§ä½å·-å§“åæ˜ å°„å­—å…¸ï¼ˆå»é‡ï¼Œä¿ç•™ç¬¬ä¸€ä¸ªï¼‰
                const seatNameMap = new Map();
                mappingData.forEach(row => {
                    const seat = String(row[seatColName]).trim();
                    const name = String(row[nameColName]).trim();
                    if (seat && name && !seatNameMap.has(seat)) {
                        seatNameMap.set(seat, name);
                    }
                });
                showStatus(`âœ… æ„å»ºæ˜ å°„å…³ç³»æˆåŠŸï¼Œå…± ${seatNameMap.size} ä¸ªæœ‰æ•ˆåº§ä½å·`, 'loading');

                // 2. å¤„ç†åº§ä½è¡¨ï¼ˆæ›¿æ¢åº§ä½å·+æ’åºï¼‰
                const sheetName = seatWorkbook.SheetNames[0]; // å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                const seatSheet = seatWorkbook.Sheets[sheetName];
                // è½¬æ¢ä¸ºJSONæ•°ç»„ï¼ˆä¾¿äºå¤„ç†ï¼‰
                const seatData = XLSX.utils.sheet_to_json(seatSheet);
                // æ›¿æ¢åº§ä½å·
                const replacedData = replaceSeatNumbers(seatData, seatNameMap, noMatch);
                // æ’åºåº§ä½åˆ—ï¼ˆæŒ‰åç¼€æ•°å­—å‡åºï¼‰
                const sortedData = sortSeatColumns(replacedData);
                // è½¬æ¢å›å·¥ä½œè¡¨
                const resultSheet = XLSX.utils.json_to_sheet(sortedData);

                // 3. ç”Ÿæˆæ–°çš„å·¥ä½œç°¿
                resultWorkbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(resultWorkbook, resultSheet, sheetName);

                showStatus(`ğŸ‰ æ›¿æ¢å®Œæˆï¼å…±åŒ¹é… ${seatNameMap.size} ä¸ªåº§ä½å·`, 'success');
                downloadBtn.disabled = false;
                downloadBtn.style.display = 'inline-block';
            } catch (err) {
                showStatus(`âŒ æ›¿æ¢å¤±è´¥ï¼š${err.message}`, 'error');
                downloadBtn.disabled = true;
                downloadBtn.style.display = 'none';
            }
        });

        // ä¸‹è½½ç»“æœæ–‡ä»¶
        downloadBtn.addEventListener('click', () => {
            if (!resultWorkbook) {
                showStatus('âŒ æ— ç»“æœæ–‡ä»¶å¯ä¸‹è½½', 'error');
                return;
            }
            // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
            const fileName = 'åº§ä½è¡¨_æ›¿æ¢å§“åå.xlsx';
            XLSX.writeFile(resultWorkbook, fileName);
            showStatus(`âœ… å·²ä¸‹è½½ï¼š${fileName}`, 'success');
        });

        /**
         * è§£æExcelæ–‡ä»¶ï¼ˆä»…è¿”å›æ•°æ®ï¼‰
         * @param file ä¸Šä¼ çš„æ–‡ä»¶
         * @param success æˆåŠŸå›è°ƒï¼ˆdata: JSONæ•°ç»„ï¼‰
         * @param error å¤±è´¥å›è°ƒï¼ˆerr: é”™è¯¯ä¿¡æ¯ï¼‰
         */
        function parseExcelFile(file, success, error) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);
                    success(jsonData);
                } catch (err) {
                    error(err.message);
                }
            };
            reader.onerror = () => {
                error('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå');
            };
            reader.readAsArrayBuffer(file);
        }

        /**
         * è§£æExcelæ–‡ä»¶ï¼ˆè¿”å›å·¥ä½œç°¿å’Œæ•°æ®ï¼‰
         * @param file ä¸Šä¼ çš„æ–‡ä»¶
         * @param success æˆåŠŸå›è°ƒï¼ˆworkbook: å·¥ä½œç°¿, data: JSONæ•°ç»„ï¼‰
         * @param error å¤±è´¥å›è°ƒï¼ˆerr: é”™è¯¯ä¿¡æ¯ï¼‰
         */
        function parseExcelFileWithWorkbook(file, success, error) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(sheet);
                    success(workbook, jsonData);
                } catch (err) {
                    error(err.message);
                }
            };
            reader.onerror = () => {
                error('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå');
            };
            reader.readAsArrayBuffer(file);
        }

        /**
         * æ›¿æ¢æ•°æ®ä¸­çš„åº§ä½å·ä¸ºå§“å
         * @param data åº§ä½è¡¨æ•°æ®ï¼ˆJSONæ•°ç»„ï¼‰
         * @param seatNameMap åº§ä½å·-å§“åæ˜ å°„
         * @param noMatch æ— åŒ¹é…æ—¶æ˜¾ç¤ºçš„æ–‡æœ¬
         * @returns æ›¿æ¢åçš„æ•°æ®
         */
        function replaceSeatNumbers(data, seatNameMap, noMatch) {
            return data.map(row => {
                const newRow = { ...row };
                // éå†æ¯ä¸€åˆ—ï¼Œæ›¿æ¢åº§ä½å·
                Object.keys(newRow).forEach(key => {
                    const value = String(newRow[key]).trim();
                    // è·³è¿‡ç©ºå€¼ã€è¿‡é“ç­‰ç‰¹æ®Šæ ‡è¯†
                    if (!value || value.includes('è¿‡é“')) return;
                    // åŒ¹é…æ˜ å°„è¡¨ï¼Œæ›¿æ¢ä¸ºå§“å
                    if (seatNameMap.has(value)) {
                        newRow[key] = seatNameMap.get(value);
                    } else {
                        newRow[key] = noMatch;
                    }
                });
                return newRow;
            });
        }

        /**
         * æŒ‰åº§ä½å·åç¼€æ•°å­—æ’åºåˆ—ï¼ˆå¦‚ A1-1â†’A1-2â†’A1-10ï¼‰
         * @param data æ›¿æ¢åçš„æ•°æ®ï¼ˆJSONæ•°ç»„ï¼‰
         * @returns æ’åºåçš„æ•°æ®
         */
        function sortSeatColumns(data) {
            if (!data.length) return data;

            // æå–è¡¨å¤´ï¼ˆåˆ—åï¼‰
            const headers = Object.keys(data[0]);
            // æ­£åˆ™ï¼šåŒ¹é…åº§ä½å·åç¼€æ•°å­—ï¼ˆå¦‚ A1-10 æå– 10ï¼‰
            const seatPattern = /[A-Za-z]+\d+\-(\d+)/;

            // æ„å»ºåˆ—åä¸æ’åºæƒé‡çš„æ˜ å°„
            const headerWeight = new Map();
            headers.forEach(header => {
                // å–ç¬¬ä¸€è¡Œæ•°æ®çš„è¯¥åˆ—å€¼ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºåº§ä½åˆ—
                const firstValue = String(data[0][header]).trim();
                const match = seatPattern.exec(firstValue);
                if (match) {
                    headerWeight.set(header, parseInt(match[1]));
                } else {
                    headerWeight.set(header, 999); // éåº§ä½åˆ—æ’æœ€å
                }
            });

            // æŒ‰æƒé‡æ’åºè¡¨å¤´
            const sortedHeaders = [...headers].sort((a, b) => {
                return headerWeight.get(a) - headerWeight.get(b);
            });

            // æŒ‰æ’åºåçš„è¡¨å¤´é‡æ–°ç»„ç»‡æ•°æ®
            return data.map(row => {
                const sortedRow = {};
                sortedHeaders.forEach(header => {
                    sortedRow[header] = row[header];
                });
                return sortedRow;
            });
        }

        /**
         * æ˜¾ç¤ºçŠ¶æ€æç¤º
         * @param text æç¤ºæ–‡æœ¬
         * @param type ç±»å‹ï¼šsuccess/error/loading
         */
        function showStatus(text, type) {
            status.textContent = text;
            status.className = type;
            // 3ç§’åæ¸…é™¤éé”™è¯¯çŠ¶æ€
            if (type !== 'error') {
                setTimeout(() => {
                    if (status.className === type) {
                        status.textContent = '';
                        status.className = '';
                    }
                }, 3000);
            }
        }

        /**
         * æ£€æŸ¥å¼€å§‹æ›¿æ¢æŒ‰é’®æ˜¯å¦å¯ç‚¹å‡»
         */
        function checkBtnStatus() {
            replaceBtn.disabled = !(mappingData && seatWorkbook && typeof XLSX !== 'undefined');
        }
    </script>
</body>
</html>